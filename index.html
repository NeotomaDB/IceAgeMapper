<html>
<head>
  <title>Title</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />
  <link rel="stylesheet" href="css/layout-default.css" />

  <style>
  #map{
    height: 100%;
    width:100%;
    padding: 0px;
  }

  .ui-layout-west{
    padding: 0px;
  }
  .ui-layout-pane {
  background:	#EEE;
}
.ui-layout-west {
  background:	#CFC;
}
.ui-layout-center {
  background:	#FFC;
  padding:	0; /* IMPORTANT - remove padding so pane can 'collapse' to 0-width */
  }
  .ui-layout-center > .wrapper {
    padding:	10px;
  }
.ui-layout-pane			{ border-width:			0; }
.ui-layout-north		{ border-bottom-width:	1px; }
.ui-layout-south		{ border-top-width:		1px; }
.ui-layout-resizer-west { border-width:			0 1px; }
.ui-layout-toggler-west { border-width:			0; }
.ui-layout-toggler-west div {
  width:	8px;
  height:	35px; /* 3x 35 = 105 total height */
}
.ui-layout-toggler-west .btnCenter	{ background: #00C; }
.ui-layout-toggler-west .btnWest	{ background: #090; }
.ui-layout-toggler-west .btnBoth	{ background: #C00; }


label {
  z-index:10000;
}

nav{
  z-index: 100000;
}
.iam-header{
  display: inline;
  padding: 0px;
  color: white;
}

.container-fluid{
  background-color: black;
  padding: 5px;
}
.navbar{
  min-height: 0px!important;
}

#bottom-chart{
  height:100%;
  width:100%;
}

svg{
  height:100%;
  width: 100%;
}

  </style>

</head>


<body>

  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <!-- <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button> -->
        <h3 class='iam-header' >Ice Age Mapper <span class='text-muted'><small>v2.0</small></span></h3>
      </div>
    </div><!--/.container-fluid -->
  </nav>

  <div class="ui-layout-west">
    <div id='map'>

    </div>
  </div>
  <div class="ui-layout-center">
    <!--tabs should go here-->
    <div id='niche-viewer'>

    </div>
  </div>
  <div class="ui-layout-south">
    <div id='bottom-chart'>

    </div>
  </div>


  <script src="https://code.jquery.com/jquery-3.1.1.js" integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA=" crossorigin="anonymous"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
  <script src="lib/jquery.layout_and_plugins.js"></script>
  <script src="https://d3js.org/d3-brush.v1.min.js"></script>

  <script>
globals = {}



function sizePane (pane, size) {
  myLayout.sizePane(pane, size);
  myLayout.open(pane); // open pane if not already
};

function createLayout(initWidth){
  // TOGGLER CUSTOMIZATION SETTINGS
  var toggleButtons	= '<div class="btnCenter"></div>'
            + '<div class="btnBoth"></div>'
            + '<div class="btnWest"></div>';
  // CREATE THE LAYOUT
  myLayout = $('body').layout({
    resizeWhileDragging: 			false,
    sizable:						false,
    animatePaneSizing:				true,
    fxSpeed:						'slow',
    west__size:						initWidth,
    spacing_open:					0,
    spacing_closed:					0,
    west__spacing_closed:			8,
    west__spacing_open:				8,
    west__togglerLength_closed:		105,
    west__togglerLength_open:		105,
    west__togglerContent_closed:	toggleButtons,
    west__togglerContent_open:		toggleButtons,
    west__onresize: resizeMapPanel,
    south__size: '20%'
  });

  myLayout.togglers.west
  // UN-BIND DEFAULT TOGGLER FUNCTIONALITY
  .unbind("click")
  // BIND CUSTOM WEST METHODS
  .find(".btnCenter")	.click( maximizeCenter ).attr("title", "Maximize Center")	.end()
  .find(".btnWest")	.click( maximizeWest )	.attr("title", "Maximize West")		.end()
  .find(".btnBoth")	.click( equalizePanes  ).attr("title", "Reset to 50/50")	.end()
;

	// CUSTOM WEST METHODS
	function maximizeCenter	(evt) { myLayout.close("west"); evt.stopPropagation(); };
	function maximizeWest	(evt) { myLayout.sizePane("west", "100%"); myLayout.open("west"); evt.stopPropagation(); };
	function equalizePanes	(evt) { myLayout.sizePane("west",  "50%"); myLayout.open("west"); evt.stopPropagation(); };
}

function createMap(){
  globals.map = L.map('map', {zoomControl:false}).setView([35, -122], 3);

  var tiles = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}', {
  	maxZoom: 8
  }).addTo(globals.map)

}

$(document).ready(function(){
  createLayout('50%');
  createMap();
});

function resizeMapPanel(){
  setTimeout(function(){ globals.map.invalidateSize()}, 10);
}

$( function() {
  $( document ).tooltip({track: true});
} );
  </script>

  <script>

var svg = d3.select("#bottom-chart").append('svg'),
    margin = {top: 20, right: 50, bottom: 30, left: 50},
    width = +$("body").width() - margin.left - margin.right,
    height = (+$("body").height() * 0.08) - margin.top - margin.bottom,
    g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var currentRange;

var x = d3.scaleLinear()
    .rangeRound([0, width]);

var y = d3.scaleLinear()
    .rangeRound([height, 0]);

var line = d3.line()
    .x(function(d) { return x(d.YearsBP); })
    .y(function(d) { return y(d.TempC); });

var brush = d3.brushX()
.extent([[0, 0], [width, height]])
  .on("brush end", brushed);

 xMap = function(d) { return x(d.YearsBP); }
 yMap = function(d){return y(d.TempC)}

 var inRange = function(d) {
    if(!currentRange || d.YearsBP < currentRange[0] || d.YearsBP > currentRange[1] ) {
        return 0;
    } else {
        return 6;
    }
}

d3.csv("data/greenlandT.csv", function(d) {
  d.TempC = +d.TempC;
  d.YearsBP = +d.YearsBP;
  return d;
}, function(error, data) {
  if (error) throw error;

  x.domain(d3.extent(data, function(d) { return d.YearsBP; }));
  y.domain(d3.extent(data, function(d) { return d.TempC; }));

  g.append("g")
      .attr("class", "axis axis--x")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

  g.append("g")
      .attr("class", "axis axis--y")
      .call(d3.axisLeft(y))
    .append("text")
      .attr("fill", "#000")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", "0.71em")
      .style("text-anchor", "end")
      .text("Temperature (C)");

  g.append("path")
      .datum(data)
      .attr("class", "line")
      .attr("d", line)
      .style('stroke', 'red')
      .style('fill', 'none');

  var gBrush = g.append("g")
          .attr("class", "brush")
          .call(brush);

});

function brushed() {
  var s = d3.event.selection;
  if (s == null) {
  } else {
    var sx = s.map(x.invert);
  }
  currentRange = sx
}
</script>


</body>
</html>
